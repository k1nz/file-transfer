# 局域网部署指南

本指南将帮助你在局域网中部署文件传输系统，让其他设备也能访问。

## 🚀 快速开始

### 1. 启动服务器
```bash
# 启动服务器（会自动显示所有可用的访问地址）
pnpm dev:server

# 或者先查看网络信息
pnpm network
```

### 2. 获取局域网 IP 地址
启动服务器后，控制台会显示所有可用的访问地址：
```
🚀 文件传输服务器已启动
📁 文件存储目录: /path/to/uploads

🌐 访问地址:
   本地访问: http://localhost:3001
   本地访问: http://127.0.0.1:3001

🔗 局域网访问:
   http://192.168.1.100:3001
   http://10.0.0.50:3001

💡 其他设备可以通过上述局域网地址访问文件传输服务
```

## 🔧 配置说明

### 服务器配置
服务器现在监听所有网络接口（`0.0.0.0`），而不仅仅是 localhost：
```javascript
app.listen(PORT, '0.0.0.0', callback)
```

### CORS 配置
已配置允许来自局域网的跨域请求：
- `192.168.x.x` - 常见家庭/办公网络
- `10.x.x.x` - 企业网络
- `172.16.x.x - 172.31.x.x` - 私有网络

## 📱 客户端连接

### 方法一：使用图形界面（推荐）
1. 在任意设备打开浏览器，访问客户端：`http://192.168.1.100:3000`
2. 点击右上角 "服务器设置"
3. 输入服务器地址：`http://192.168.1.100:3001`
4. 点击连接测试
5. 保存设置

### 方法二：使用环境变量
在客户端设备上：
```bash
# 创建环境变量文件
echo "VITE_SERVER_URL=http://192.168.1.100:3001" > client/.env.local

# 启动客户端
pnpm dev:client
```

## 🛠️ 网络工具

### 查看网络信息
```bash
# 显示所有网络接口和访问地址
pnpm network

# 或直接运行脚本
node scripts/network-info.js
```

### 测试连接
```bash
# 测试服务器是否可访问
curl http://192.168.1.100:3001/

# 测试文件上传 API
curl -X GET http://192.168.1.100:3001/api/files
```

## 🔍 故障排查

### 1. 无法连接到服务器

**检查防火墙设置：**

**macOS：**
```bash
# 查看防火墙状态
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate

# 临时关闭防火墙（测试用）
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate off
```

**Windows：**
- 控制面板 > 系统和安全 > Windows Defender 防火墙
- 点击 "允许应用或功能通过 Windows Defender 防火墙"
- 添加端口 3001 的入站规则

**Linux：**
```bash
# Ubuntu/Debian
sudo ufw allow 3001

# CentOS/RHEL
sudo firewall-cmd --permanent --add-port=3001/tcp
sudo firewall-cmd --reload
```

### 2. CORS 错误

如果在浏览器控制台看到 CORS 错误，检查：
1. 服务器是否正确启动
2. 客户端访问的地址是否在允许列表中
3. 网络地址是否正确

### 3. 网络连通性测试

```bash
# 从其他设备测试网络连通性
ping 192.168.1.100

# 测试端口连通性
telnet 192.168.1.100 3001

# 使用 nmap 扫描端口
nmap -p 3001 192.168.1.100
```

## 📋 常见网络场景

### 家庭网络（路由器）
- IP 段：`192.168.1.x` 或 `192.168.0.x`
- 设备可以相互访问
- 需要关闭路由器的 AP 隔离功能

### 办公网络
- IP 段：`192.168.x.x` 或 `10.x.x.x`
- 可能有网络策略限制
- 联系网络管理员开放端口

### 移动热点
- IP 段通常为 `192.168.43.x`
- 部分手机的热点功能会隔离设备
- 尝试使用"允许其他设备连接"选项

## 🔐 安全考虑

### 基本安全措施
1. **仅在受信任的网络中使用**
2. **不要在公共 WiFi 中启用**
3. **定期清理上传的文件**
4. **考虑添加访问密码**（未来功能）

### 限制访问范围
如果需要限制访问，可以修改 CORS 配置中的 IP 段：
```javascript
// 只允许特定 IP 段
/^http:\/\/192\.168\.1\.\d{1,3}(:\d+)?$/
```

## 📱 移动设备访问

### iOS/Android
1. 连接到同一 WiFi 网络
2. 打开浏览器
3. 访问：`http://局域网IP:3000`
4. 配置服务器地址：`http://局域网IP:3001`

### 文件上传
移动设备可以：
- 📷 上传照片和视频
- 📄 上传文档文件
- 🎵 上传音频文件
- 拖拽上传（支持的浏览器）

## 🎯 使用场景

### 团队协作
- 快速分享设计文件
- 传输大型视频文件
- 共享代码包

### 家庭使用
- 手机照片备份
- 电视盒子文件传输
- 跨设备文件同步

### 临时文件传输
- 会议文件分享
- 演示文稿传输
- 快速文件交换

## 📊 性能优化

### 大文件传输
- 默认支持最大 100MB 文件
- 在良好的局域网环境下传输速度通常为 10-100MB/s
- 建议使用有线网络获得最佳性能

### 并发连接
- 支持多设备同时访问
- 支持多文件并行上传
- 服务器资源占用较低
